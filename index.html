<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="style.css">
    
    <title>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –≤ Telegram</title>
    
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è Telegram Mini App */
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f1f1f1;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
        }
        
        .telegram-mini-app {
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ–∫–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è Telegram */
        }
        
        .loading-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .telegram-only {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading" class="loading-screen">
        <h1>üõçÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞...</h1>
        <p>–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Telegram Mini App</p>
        <div id="loader" style="margin-top: 20px;">
            <div style="width: 40px; height: 40px; border: 4px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        </div>
        <p id="status" style="margin-top: 20px; font-size: 14px;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</p>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Telegram) -->
    <div id="app" class="telegram-mini-app">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="header-top">
                <h1>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</h1>
                <div class="user-info">
                    <span id="user-name">–ì–æ—Å—Ç—å</span>
                    <button id="cart-toggle">üõí <span id="cart-count">0</span></button>
                </div>
            </div>
            
            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-box">
                <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞..." autocomplete="off">
                <button onclick="searchProducts()">üîç</button>
            </div>
            
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="categories" id="categories">
                <button data-category="all" class="active">–í—Å–µ</button>
                <button data-category="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
                <button data-category="clothes">–û–¥–µ–∂–¥–∞</button>
                <button data-category="books">–ö–Ω–∏–≥–∏</button>
                <button data-category="home">–î–ª—è –¥–æ–º–∞</button>
            </div>
            
            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
            <div class="sort">
                <select id="sort" onchange="sortProducts()">
                    <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                    <option value="cheap">–°–Ω–∞—á–∞–ª–∞ –¥–µ—à–µ–≤—ã–µ</option>
                    <option value="expensive">–°–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ</option>
                    <option value="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                </select>
                
                <select id="price-filter" onchange="filterByPrice()">
                    <option value="all">–õ—é–±–∞—è —Ü–µ–Ω–∞</option>
                    <option value="0-1000">–î–æ 1000 ‚ÇΩ</option>
                    <option value="1001-5000">1000-5000 ‚ÇΩ</option>
                    <option value="5001+">–û—Ç 5000 ‚ÇΩ</option>
                </select>
            </div>
        </header>

        <!-- –¢–æ–≤–∞—Ä—ã -->
        <div class="products" id="product-list"></div>

        <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
        <div class="cart-panel" id="cart-panel">
            <div class="cart-header">
                <h3>üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
                <button onclick="closeCart()">√ó</button>
            </div>
            <div class="cart-items" id="cart-items"></div>
            <div class="cart-total">
                –ò—Ç–æ–≥–æ: <span id="total-price">0</span> ‚ÇΩ
                <button onclick="checkout()">‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å</button>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
        <button class="cart-btn" onclick="openCart()">
            üõí <span id="cart-count-big">0</span>
        </button>
        
        <!-- –ö–Ω–æ–ø–∫–∞ Telegram -->
        <div class="telegram-only" id="tg-buttons">
            <button id="tg-main-button" style="display: none;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ -->
    <div id="browser-message" style="display: none; text-align: center; padding: 40px;">
        <h2>üì± –≠—Ç–æ Telegram Mini App</h2>
        <p>–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram.</p>
        <p>–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é.</p>
        <button onclick="window.location.href='https://t.me/–≤–∞—à_–±–æ—Ç'" style="padding: 12px 24px; background: #0088cc; color: white; border: none; border-radius: 10px; font-size: 16px; margin-top: 20px;">
            üì≤ –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram
        </button>
    </div>

    <script src="app.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
        function initTelegramApp() {
            const loading = document.getElementById('loading');
            const app = document.getElementById('app');
            const browserMsg = document.getElementById('browser-message');
            const status = document.getElementById('status');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                status.textContent = 'Telegram –Ω–∞–π–¥–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
                
                const tg = window.Telegram.WebApp;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                tg.ready();
                tg.expand(); // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
                document.body.style.backgroundColor = tg.themeParams.bg_color || '#ffffff';
                document.body.style.color = tg.themeParams.text_color || '#000000';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (tg.initDataUnsafe.user) {
                    const userName = document.getElementById('user-name');
                    const user = tg.initDataUnsafe.user;
                    userName.textContent = user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    if (user.username) {
                        userName.innerHTML += ` <small>@${user.username}</small>`;
                    }
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                tg.MainButton.text = "üõí –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑";
                tg.MainButton.color = "#4CAF50";
                tg.MainButton.textColor = "#FFFFFF";
                tg.MainButton.onClick(checkout);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                setTimeout(() => {
                    loading.style.display = 'none';
                    app.style.display = 'block';
                    document.getElementById('tg-buttons').style.display = 'block';
                    status.textContent = '–ì–æ—Ç–æ–≤–æ!';
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
                    if (window.initApp) {
                        window.initApp();
                    }
                }, 1000);
                
                console.log('‚úÖ Telegram Mini App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
            } else {
                // –ù–µ –≤ Telegram - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                status.textContent = 'Telegram –Ω–µ –Ω–∞–π–¥–µ–Ω';
                
                setTimeout(() => {
                    loading.style.display = 'none';
                    browserMsg.style.display = 'block';
                }, 2000);
                
                console.log('‚ö†Ô∏è –û—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∞ –Ω–µ –≤ Telegram');
            }
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
        document.addEventListener('DOMContentLoaded', initTelegramApp);
    </script>
</body>
</html>
